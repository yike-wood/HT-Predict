<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Predict Risk of HT</title><link rel="preconnect" href="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/"><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;line-height:1.6;color:#333;background:#f8f9fa;min-height:100vh}.navbar{background:rgba(255,255,255,.98);position:fixed;top:0;width:100%;z-index:1000;box-shadow:0 1px 3px rgba(0,0,0,.1);border-bottom:1px solid #e9ecef}.nav-container{max-width:1200px;margin:0 auto;padding:0 2rem;display:flex;justify-content:space-between;align-items:center;height:70px}.nav-title{font-size:1.5rem;font-weight:600;color:#495057}.nav-menu{display:flex;list-style:none;gap:2rem}.nav-link{text-decoration:none;color:#6c757d;font-weight:500;padding:.5rem 1rem;border-radius:6px;transition:all .3s ease}.nav-link.active,.nav-link:hover{color:#4a90e2;background:rgba(74,144,226,.08)}.main-content{margin-top:70px;min-height:calc(100vh - 140px)}.section{display:none;padding:2rem 0}.section.active{display:block}.hero{text-align:center;padding:1rem 1rem;background:#fff;margin:2rem auto;max-width:1200px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.06);border:1px solid #e9ecef}.hero h1{font-size:2.5rem;margin-bottom:1rem;color:#495057;font-weight:600}.hero h2{font-size:1.3rem;color:#6c757d;font-weight:400}.content-wrapper{max-width:1200px;margin:0 auto;padding:0 2rem;display:grid;grid-template-columns:2fr 1fr;gap:2rem;align-items:start}.intro-section{background:#fff;padding:2rem;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.06);border:1px solid #e9ecef}.intro-section h3{color:#495057;margin-bottom:1rem;font-size:1.3rem;font-weight:600}.intro-section p{margin-bottom:1.5rem;text-align:justify;line-height:1.8;color:#6c757d}.quick-actions{background:#fff;padding:2rem;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.06);border:1px solid #e9ecef;height:fit-content}.quick-actions h3{color:#495057;margin-bottom:1.5rem;text-align:center;font-weight:600}.action-buttons{display:flex;flex-direction:column;gap:1rem}.btn{padding:1rem 2rem;border:none;border-radius:6px;font-weight:500;cursor:pointer;transition:all .3s ease;text-decoration:none;display:inline-block;text-align:center;font-size:1rem}.btn-primary{background:#4a90e2;color:#fff}.btn-primary:hover{background:#357abd;transform:translateY(-1px);box-shadow:0 3px 12px rgba(74,144,226,.25)}.btn-secondary{background:#f8f9fa;color:#4a90e2;border:1px solid #4a90e2}.btn-secondary:hover{background:#4a90e2;color:#fff}.calculator-container{max-width:800px;margin:0 auto;padding:0 2rem}.calculator-form{background:#fff;padding:2rem;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.06);border:1px solid #e9ecef;margin-bottom:2rem}.form-row{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:1.5rem}.form-group{margin-bottom:1.5rem}.form-group label{display:block;margin-bottom:.5rem;font-weight:500;color:#495057}.form-group input[type=number]{width:100%;padding:.75rem;border:1px solid #ced4da;border-radius:6px;font-size:1rem;transition:border-color .3s ease}.form-group input[type=number]:focus{outline:0;border-color:#4a90e2;box-shadow:0 0 0 3px rgba(74,144,226,.1)}.radio-group{display:flex;gap:1rem}.radio-group label{display:flex;align-items:center;gap:.5rem;font-weight:400;cursor:pointer;color:#6c757d}.result-container{background:#fff;padding:1rem;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.06);border:1px solid #e9ecef;text-align:center}.risk-display{display:flex;justify-content:center;align-items:center;gap:1rem;padding:1.5rem;background:#4a90e2;border-radius:6px;color:#fff}.risk-label{font-size:1.2rem;font-weight:500}.risk-value{font-size:2rem;font-weight:600}.risk-interpretation{padding:1rem;background:rgba(74,144,226,.08);border-radius:6px;border-left:4px solid #4a90e2;color:#495057}.examples-grid{display:grid;grid-template-columns:1fr;gap:2rem;max-width:1200px;margin:0 auto;padding:0 2rem}.example-card{background:#fff;padding:2rem;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.06);border:1px solid #e9ecef;transition:all .3s ease;cursor:pointer;overflow:hidden}.example-card:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.1)}.example-card.expanded{transform:none;box-shadow:0 6px 20px rgba(0,0,0,.15)}.example-card h4{color:#495057;margin-bottom:1rem;font-size:1.3rem;font-weight:600;display:flex;justify-content:space-between;align-items:center}.example-card .expand-icon{font-size:1rem;color:#4a90e2;transition:transform .3s ease}.example-card.expanded .expand-icon{transform:rotate(180deg)}.patient-info{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-bottom:1rem;font-size:.9rem}.patient-info .label{font-weight:500;color:#6c757d}.patient-info .value{color:#495057}.risk-comparison{margin-top:1.5rem;padding:1rem;background:rgba(74,144,226,.08);border-radius:6px}.risk-values{display:flex;justify-content:space-evenly;font-weight:500;color:#495057;margin-bottom:.5rem}.risk-values:last-child{margin-bottom:0}.example-images{max-height:0;overflow:hidden;transition:max-height .4s ease;margin-top:1rem}.example-card.expanded .example-images{max-height:3840px;max-width:1920px}.images-grid{display:grid;grid-template-columns:1fr;gap:1.5rem;padding-top:1rem;border-top:1px solid #e9ecef}.image-item{text-align:center}.image-item h5{color:#495057;margin-bottom:.5rem;font-size:.9rem;font-weight:600}.image-item img{width:100%;max-width:1920px;height:auto;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,.1);border:1px solid #e9ecef}.image-placeholder{width:100%;max-width:400px;height:200px;background:#f8f9fa;border:2px dashed #dee2e6;border-radius:6px;display:flex;align-items:center;justify-content:center;color:#6c757d;font-size:.85rem;margin:0 auto}.footer{background:#fff;text-align:center;padding:2rem;margin-top:1rem;color:#6c757d;border-top:1px solid #e9ecef}.floating-stats{background:rgba(255,255,255,.95);padding:.75rem 1rem;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,.15);border:1px solid #e9ecef;font-size:.85rem;color:#6c757d;backdrop-filter:blur(10px);transition:all .3s ease;position:relative;margin:1rem auto .5rem auto;max-width:800px;display:flex;align-items:center;justify-content:center;gap:2rem}.floating-stats.floating-mode{position:fixed;bottom:20px;right:20px;z-index:1000;min-width:140px;flex-direction:column;gap:0;padding:.75rem 1rem;margin:0;max-width:none}.floating-stats .stats-content{display:flex;align-items:center;gap:1.5rem}.floating-stats.floating-mode .stats-content{flex-direction:column;gap:0}.floating-stats .stats-title{font-weight:600;color:#495057;margin-bottom:0;margin-right:1rem}.floating-stats.floating-mode .stats-title{margin-bottom:.25rem;margin-right:0;text-align:center}.floating-stats .stats-item{display:flex;justify-content:space-between;margin-bottom:0;white-space:nowrap}.floating-stats.floating-mode .stats-item{margin-bottom:.2rem}.floating-stats.floating-mode .stats-item:last-child{margin-bottom:0}.stats-toggle{position:absolute;top:-8px;right:-8px;width:24px;height:24px;background:#4a90e2;color:#fff;border:none;border-radius:50%;cursor:pointer;display:none;align-items:center;justify-content:center;font-size:12px;transition:all .3s ease;box-shadow:0 2px 8px rgba(74,144,226,.3)}.stats-toggle:hover{background:#357abd;transform:scale(1.1)}.floating-stats:hover .stats-toggle{display:flex}.model-usage{background:rgba(74,144,226,.08);padding:1rem;border-radius:6px;border-left:4px solid #4a90e2;margin-bottom:1rem;text-align:center}.model-usage h4{color:#495057;margin-bottom:.5rem;font-size:1rem;font-weight:600}.model-usage .usage-count{font-size:1.5rem;font-weight:600;color:#4a90e2}.loading{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:none;flex-direction:column;justify-content:center;align-items:center;z-index:9999}.spinner{width:50px;height:50px;border:4px solid #f3f3f3;border-top:4px solid #4a90e2;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:1rem}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.scatter-plot-container{display:flex;justify-content:center;align-items:center;width:100%;margin:2rem 0}.scatter-plot-wrapper{background:#fff;border:1px solid #4a90e2;border-radius:8px;padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,.06);min-width:480px;max-width:700px;width:92%}#scatter-plot{width:100%;height:500px;min-height:450px}.scatter-plot-title{text-align:center;color:#495057;margin-bottom:1rem;font-size:1.2rem;font-weight:600}@media (max-width:768px){.content-wrapper{grid-template-columns:1fr}.form-row{grid-template-columns:1fr}.examples-grid{grid-template-columns:1fr}.hero h1{font-size:2rem}.scatter-plot-wrapper{min-width:320px;width:95%}#scatter-plot{height:400px;min-height:350px}.floating-stats{flex-direction:column;gap:.5rem;padding:.5rem 1rem;font-size:.75rem;margin:1rem auto .5rem auto}.floating-stats .stats-content{flex-direction:column;gap:.5rem}.floating-stats .stats-title{font-size:.8rem;margin-right:0;margin-bottom:.25rem}.floating-stats.floating-mode{position:fixed;bottom:10px;right:10px;margin:0;max-width:none;min-width:120px;flex-direction:column;gap:0;padding:.5rem .75rem}.floating-stats.floating-mode .stats-content{flex-direction:column;gap:0}.floating-stats.floating-mode .stats-item{margin-bottom:.2rem}.floating-stats.floating-mode .stats-item:last-child{margin-bottom:0}.stats-toggle{width:20px;height:20px;font-size:10px;top:-6px;right:-6px}.images-grid{grid-template-columns:1fr;gap:1rem}.image-item img{max-width:100%}.image-placeholder{max-width:100%;height:180px}}</style></head><body><script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js" async></script><script>window.HT_APP_DATA={apiUrl:"https://api2024.ht-project.top/api/",examples:[{id:807925,name:"Chen",Gender:0,Age:81,NIHSS:6,Hypertension:1,Time_from_onset_to_MRI:2.75,ADC_620:6,Tmax_4s:36,Tmax_6s:12,Tmax_8s:5,Tmax_10s:3,PWI_DWI_mismatch:30,HIR:.25,practicalRisk:.29831563533882444,refinedRisk:.2247,pic0:"./assets/dPic/Chen_Ping_DWI.png",pic1:"./assets/dPic/Chen_Ping_Tmax.png"},{id:789435,name:"Lv",Gender:1,Age:59,NIHSS:20,Hypertension:1,Time_from_onset_to_MRI:7,ADC_620:91,Tmax_4s:355,Tmax_6s:226,Tmax_8s:148,Tmax_10s:103,PWI_DWI_mismatch:264,HIR:.456,practicalRisk:.8859269566386272,refinedRisk:.9143491645251275,pic0:"./assets/dPic/Lv_Yi_DWI.png",pic1:"./assets/dPic/Lv_Yi_Tmax.png"},{id:770872,name:"Guo",Gender:1,Age:52,NIHSS:8,Hypertension:1,Time_from_onset_to_MRI:6,ADC_620:34,Tmax_4s:167,Tmax_6s:88,Tmax_8s:56,Tmax_10s:32,PWI_DWI_mismatch:133,HIR:.364,practicalRisk:.5287718006642818,refinedRisk:.6774,pic0:"./assets/dPic/Guo_Wei_DWI.png",pic1:"./assets/dPic/Guo_Wei_Tmax.png"}],scatterData:[{var0:53,var1:.2,var2:4,label:0},{var0:37,var1:0,var2:9,label:0},{var0:40,var1:.4,var2:2,label:0},{var0:42,var1:0,var2:7,label:0},{var0:46,var1:0,var2:2,label:0},{var0:50,var1:.3,var2:4,label:0},{var0:54,var1:0,var2:4,label:0},{var0:65,var1:.2,var2:8,label:0},{var0:109,var1:.1,var2:6,label:0},{var0:159,var1:.2,var2:0,label:0},{var0:98,var1:.2,var2:2,label:0},{var0:114,var1:.3,var2:9,label:0},{var0:149,var1:.1,var2:2,label:0},{var0:127,var1:.5,var2:7,label:0},{var0:63,var1:0,var2:12,label:0},{var0:56,var1:0,var2:9,label:0},{var0:58,var1:.3,var2:0,label:0},{var0:54,var1:.2,var2:17,label:0},{var0:47,var1:.1,var2:3,label:0},{var0:45,var1:.6,var2:2,label:0},{var0:31,var1:0,var2:10,label:0},{var0:29,var1:.1,var2:4,label:0},{var0:28,var1:.3,var2:14,label:0},{var0:28,var1:.8,var2:2,label:0},{var0:28,var1:0,var2:6,label:0},{var0:25,var1:.2,var2:4,label:0},{var0:23,var1:0,var2:2,label:0},{var0:23,var1:0,var2:6,label:0},{var0:22,var1:0,var2:4,label:0},{var0:22,var1:0,var2:2,label:0},{var0:21,var1:0,var2:1,label:0},{var0:20,var1:.2,var2:3,label:0},{var0:15,var1:.3,var2:6,label:0},{var0:14,var1:.7,var2:6,label:0},{var0:12,var1:0,var2:8,label:0},{var0:12,var1:0,var2:2,label:0},{var0:11,var1:0,var2:1,label:0},{var0:10,var1:1,var2:8,label:0},{var0:9,var1:0,var2:9,label:0},{var0:7,var1:0,var2:2,label:0},{var0:6,var1:0,var2:17,label:0},{var0:6,var1:0,var2:3,label:0},{var0:6,var1:0,var2:0,label:0},{var0:4,var1:0,var2:0,label:0},{var0:0,var1:0,var2:19,label:0},{var0:0,var1:0,var2:11,label:0},{var0:0,var1:0,var2:10,label:0},{var0:0,var1:0,var2:8,label:0},{var0:0,var1:0,var2:6,label:0},{var0:0,var1:0,var2:5,label:0},{var0:0,var1:0,var2:3,label:0},{var0:0,var1:0,var2:2,label:0},{var0:0,var1:0,var2:1,label:0},{var0:0,var1:0,var2:0,label:0},{var0:300,var1:.6,var2:35,label:1},{var0:220,var1:.4,var2:14,label:1},{var0:219,var1:.6,var2:18,label:1},{var0:218,var1:.7,var2:17,label:1},{var0:217,var1:.8,var2:20,label:1},{var0:215,var1:.2,var2:2,label:1},{var0:192,var1:.5,var2:7,label:1},{var0:190,var1:.5,var2:15,label:1},{var0:182,var1:.7,var2:35,label:1},{var0:175,var1:.5,var2:10,label:1},{var0:167,var1:.6,var2:16,label:1},{var0:167,var1:.2,var2:9,label:1},{var0:165,var1:.7,var2:15,label:1},{var0:156,var1:.6,var2:22,label:1},{var0:156,var1:.6,var2:5,label:1},{var0:147,var1:.5,var2:22,label:1},{var0:142,var1:.9,var2:0,label:1},{var0:139,var1:.5,var2:10,label:1},{var0:134,var1:.3,var2:7,label:1},{var0:132,var1:.4,var2:37,label:1},{var0:121,var1:.5,var2:12,label:1},{var0:121,var1:.2,var2:1,label:1},{var0:120,var1:.5,var2:24,label:1},{var0:114,var1:.6,var2:8,label:1},{var0:106,var1:.3,var2:35,label:1},{var0:105,var1:.3,var2:16,label:1},{var0:99,var1:.4,var2:8,label:1},{var0:96,var1:.5,var2:15,label:1},{var0:88,var1:.4,var2:8,label:1},{var0:88,var1:.1,var2:10,label:1},{var0:80,var1:.6,var2:6,label:1},{var0:77,var1:.6,var2:21,label:1},{var0:75,var1:.1,var2:13,label:1},{var0:71,var1:.3,var2:6,label:1},{var0:59,var1:.5,var2:12,label:1},{var0:56,var1:.1,var2:16,label:1},{var0:53,var1:.7,var2:16,label:1},{var0:53,var1:.1,var2:9,label:1},{var0:41,var1:.3,var2:1,label:1}]}</script><nav class="navbar"><div class="nav-container"><h1 class="nav-title">Predict the Risk of HT</h1><ul class="nav-menu"><li><a href="#home" class="nav-link active" data-section="home">Home</a></li><li><a href="#hybrid" class="nav-link" data-section="hybrid">Subgroup-driven Model</a></li><li><a href="#examples" class="nav-link" data-section="examples">Examples</a></li></ul></div></nav><main class="main-content"><section id="home" class="section active"><div class="hero"><h1>Predict the Risk of Hemorrhagic transformation (HT) after Acute Ischemic Stroke (AIS)</h1><h2>Hemorrhage Transformation Prediction in Stroke</h2></div><div class="content-wrapper"><div class="intro-section"><h3>Objectives</h3><p>Hemorrhagic transformation (HT) following acute ischemic stroke (AIS) critically affects patient prognosis. This study aims to develop reliable machine learning (ML) models for predicting HT in AIS patients using magnetic resonance imaging (MRI).</p><h3>Materials and Methods</h3><p>543 AIS patients were enrolled (HT: 166; non-HT: 377) and randomly split into the training and testing set with a ratio of 80% to 20%. All underwent MRI, including diffusion- (DWI) and perfusion-weighted imaging (PWI), within 24 hours of symptom onset, and had follow-up CT or MRI within 14 days. Clinical baseline features and MRI parameters (volumes of ADC &lt; 620 × 10⁻⁶ mm²/s, various Tmax thresholds, PWI-DWI mismatch area, and hypoperfusion intensity ratio [HIR]) were collected. Six ML algorithms—Logistic Regression, Support Vector Machine, Decision Tree, XGBoost, LightGBM, and Random Forest—were trained and optimized. Various fusion models were created, including soft voting, stacking, and integrating subgroup-based modeling into robust baseline models. The best-performing model was selected based on testing set performance.</p><h3>Results</h3><p>The Random Forest-based model performed best with a relatively high area under the curve (AUC) of 0.933 (95% CI: 0.883-0.973). The proposed subgroup-driven fusion model, by utilizing Decision Tree as stratification mechanism and subgroup-tailored baseline models (Decision Tree, LightGBM, Random Forest), achieved the highest AUC of 0.951 (95% CI: 0.906–0.988) with an accuracy of 93.6% (95% CI: 89.0-98.2) among all fusion models and exceeded all baseline models. This model is accessible at <a href="https://yike-wood.github.io/HT-Predict/">https://yike-wood.github.io/HT-Predict/</a>.</p><h3>Conclusion</h3><p>The proposed subgroup-driven model, leveraging MRI-DWI and PWI, reliably predicts HT in AIS patients, potentially aiding radiologists and clinicians in timely HT risk assessment post-MRI.</p><h3>Clinical relevance statement</h3><p>This study describes the application of machine learning to predict hemorrhagic transformation after stroke from 543 patients based on their MRI parameters and baseline features. A proposed subgroup-driven fusion model has been developed with good performance and is available for clinical use with public access at <a href="https://yike-wood.github.io/HT-Predict/">https://yike-wood.github.io/HT-Predict/</a>.</p></div><div class="quick-actions"><h3>Risk Calculator</h3><div class="action-buttons"><button class="btn btn-primary" onclick='showSection("hybrid")'>Subgroup-driven Model</button> <button class="btn btn-secondary" onclick='showSection("examples")'>View Examples</button></div></div></div></section><section id="hybrid" class="section"><div class="hero"><h1>Subgroup-driven Model - HT Risk Prediction</h1></div><div class="calculator-container"><form id="hybrid-form" class="calculator-form"><div class="form-row"><div class="form-group"><label>Gender</label><div class="radio-group"><label><input type="radio" name="gender" value="1" required> Male</label> <label><input type="radio" name="gender" value="0" required> Female</label></div></div><div class="form-group"><label>Hypertension</label><div class="radio-group"><label><input type="radio" name="hypertension" value="1" required> Yes</label> <label><input type="radio" name="hypertension" value="0" required> No</label></div></div></div><div class="form-row"><div class="form-group"><label>RT (Reperfusion Therapy)</label><div class="radio-group"><label><input type="radio" name="rt" value="1" required> Yes</label> <label><input type="radio" name="rt" value="0" required> No</label></div></div><div class="form-group"><label for="age">Age</label> <input type="number" id="age" name="age" min="0" max="120" required></div></div><div class="form-row"><div class="form-group"><label for="nihss">NIHSS Admission Score</label> <input type="number" id="nihss" name="nihss" min="0" max="42" required></div><div class="form-group"><label for="onset-time">Time from onset to MRI (hours)</label> <input type="number" id="onset-time" name="onset_time" step="0.001" min="0" required></div></div><div class="form-row"><div class="form-group"><label for="adc620">ADC &lt; 620×10⁻⁶ Volume (mL)</label> <input type="number" id="adc620" name="adc620" step="0.1" min="0" required></div><div class="form-group"><label for="tmax4s">Tmax > 4s Volume (mL)</label> <input type="number" id="tmax4s" name="tmax4s" step="0.01" min="0" required></div></div><div class="form-row"><div class="form-group"><label for="tmax6s">Tmax > 6s Volume (mL)</label> <input type="number" id="tmax6s" name="tmax6s" step="0.01" min="0" required></div><div class="form-group"><label for="tmax8s">Tmax > 8s Volume (mL)</label> <input type="number" id="tmax8s" name="tmax8s" step="0.01" min="0" required></div></div><div class="form-row"><div class="form-group"><label for="tmax10s">Tmax > 10s Volume (mL)</label> <input type="number" id="tmax10s" name="tmax10s" step="0.01" min="0" required></div><div class="form-group"></div></div><button type="submit" class="btn btn-primary">Calculate Risk</button></form><div id="hybrid-result" class="result-container" style="display:none"><h3>HT Risk Prediction Result</h3><div class="risk-display"><span class="risk-label">Risk Probability:</span> <span id="hybrid-risk-value" class="risk-value">--</span></div></div><div class="scatter-plot-container"><div class="scatter-plot-wrapper"><div id="scatter-plot"></div></div></div></div></section><section id="examples" class="section"><div class="hero"><h1>Examples</h1></div><div id="examples-list" class="examples-grid"></div></section></main><div id="floating-stats" class="floating-stats"><button class="stats-toggle" id="stats-toggle" title="Switch to floating mode">📌</button><div class="stats-content"><div class="stats-title">Only for Research.</div><div class="stats-item"><span>Home Views:</span> <span id="home-views">--</span></div><div class="stats-item"><span>Model Usage:</span> <span id="hybrid-usage">--</span></div></div></div><footer class="footer"><p>&copy; 2025 Shanghai Fourth People's Hospital | Active Health & Analyze Lab - Duke Kunshan University. All Rights Reserved.</p></footer><div id="loading" class="loading"><div class="spinner"></div><p>Calculating...</p></div><script>const CONFIG={get API_URL(){return window.HT_APP_DATA?.apiUrl||"https://api2024.ht-project.top/api/"}};let appState={currentSection:"home",examples:[],pageViews:{home:0,hybrid:0},modelUsage:{hybrid:0},statsMode:"fixed",isLoading:!1};function initializeApp(){const e=window.location.hash.substring(1);e&&["home","hybrid","examples"].includes(e)?showSection(e):showSection("home")}function setupEventListeners(){document.querySelectorAll(".nav-link").forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault();const t=this.dataset.section;showSection(t),window.location.hash=t}))}));const e=document.getElementById("hybrid-form");e&&e.addEventListener("submit",handleHybridFormSubmit),window.addEventListener("hashchange",(function(){const e=window.location.hash.substring(1);e&&["home","hybrid","examples"].includes(e)&&showSection(e)}))}function showSection(e){document.querySelectorAll(".nav-link").forEach((t=>{t.classList.remove("active"),t.dataset.section===e&&t.classList.add("active")})),document.querySelectorAll(".section").forEach((t=>{t.classList.remove("active"),t.id===e&&t.classList.add("active")})),appState.currentSection=e,"hybrid"===e&&setTimeout((()=>{initializeScatterPlot()}),100)}async function handleHybridFormSubmit(e){e.preventDefault();const t=new FormData(e.target),a=parseFloat(t.get("tmax6s")),n=parseFloat(t.get("tmax10s")),s=a>0?n/a:0,o=parseFloat(t.get("tmax4s"))-parseFloat(t.get("adc620")),i={type:"hybrid",record:{Age:parseInt(t.get("age")),Gender:parseInt(t.get("gender")),NIHSS:parseInt(t.get("nihss")),Diabetes_mellitus:0,Hypertension:parseInt(t.get("hypertension")),Atrial_fibrillation:0,Time_from_onset_to_MRI:parseFloat(t.get("onset_time")),ADC_620:parseFloat(t.get("adc620")),Tmax_4s:parseFloat(t.get("tmax4s")),Tmax_6s:a,Tmax_8s:parseFloat(t.get("tmax8s")),Tmax_10s:n,PWI_DWI_mismatch:o,HIR:s,RT:parseInt(t.get("rt"))}};try{showLoading(!0);displayHybridResult(await predictRisk(i)),updateScatterPlot(a,s,parseInt(t.get("nihss")))}catch(e){console.error("Prediction failed:",e),'alert("Calculation failed, please check input data or try again later")'}finally{showLoading(!1)}}function initializeScatterPlot(){window.Plotly&&window.HT_APP_DATA?.scatterData?updateScatterPlot():console.warn("Plotly or scatter plot data not loaded")}function updateScatterPlot(e=null,t=null,a=null){const n=window.HT_APP_DATA.scatterData,s={x:[],y:[],z:[]},o={x:[],y:[],z:[]};n.forEach((e=>{1===e.label?(s.x.push(e.var0),s.y.push(e.var1),s.z.push(e.var2)):(o.x.push(e.var0),o.y.push(e.var1),o.z.push(e.var2))}));const i=[{x:s.x,y:s.y,z:s.z,mode:"markers",marker:{color:"rgba(255, 0, 0, 0.8)",size:4,line:{color:"rgba(255, 0, 0, 0.3)",width:.5},opacity:.8},type:"scatter3d",name:"HT Patients"},{x:o.x,y:o.y,z:o.z,mode:"markers",marker:{color:"rgba(0, 0, 255, 0.8)",size:4,line:{color:"rgba(0, 0, 255, 0.3)",width:.5},opacity:.8},type:"scatter3d",name:"Non-HT Patients"}];null!==e&&null!==t&&null!==a&&i.push({x:[e],y:[t],z:[a],mode:"markers",marker:{color:"rgba(0, 255, 0, 0.9)",size:8,symbol:"diamond",opacity:.9},type:"scatter3d",name:"Your Input"});const l={margin:{l:0,r:0,b:0,t:0,pad:0},scene:{xaxis:{title:{text:"Tmax > 6s (mL)",font:{size:12}},linewidth:2},yaxis:{title:{text:"HIR",font:{size:12}},linewidth:2},zaxis:{title:{text:"NIHSS Score",font:{size:12}},linewidth:2},camera:{eye:{x:1.5,y:1.5,z:1.5}}},legend:{orientation:"h",x:0,y:1,traceorder:"normal",font:{size:10},bgcolor:"rgba(232, 232, 232, 0.8)",bordercolor:"#FFFFFF",borderwidth:1},paper_bgcolor:"rgba(255, 255, 255, 0.95)",plot_bgcolor:"rgba(255, 255, 255, 0.95)"},r=document.getElementById("scatter-plot");r&&Plotly.newPlot(r,i,l,{responsive:!0,displayModeBar:!0,modeBarButtonsToRemove:["pan2d","lasso2d","select2d"]})}async function predictRisk(e){try{const t=await fetch(CONFIG.API_URL+"predict",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(t){return console.warn("API request failed, using local calculation",t),calculateRiskLocally(e)}}function calculateRiskLocally(e){let t=0;if("hybrid"===e.type){const a=e.record,n=.02*(a.Tmax_6s||0)+2*(a.HIR||0)+.05*(a.NIHSS||0);t=1/(1+Math.exp(3-n))}return{probability:t,hybrid:(e.hybrid||0)+1}}function displayHybridResult(e){console.log(e),void 0!==e.hybrid&&(appState.modelUsage.hybrid=e.hybrid,updateFloatingStats());const t=(100*e.probability).toFixed(2);document.getElementById("hybrid-risk-value").textContent=`${t}%`,document.getElementById("hybrid-result").style.display="block",document.getElementById("hybrid-result").scrollIntoView({behavior:"smooth"})}function loadExamples(){try{window.HT_APP_DATA&&window.HT_APP_DATA.examples?(appState.examples=window.HT_APP_DATA.examples.map((e=>({...e,hybridRisk:"Chen"===e.name?.2323:"Lv"===e.name?.8199:"Guo"===e.name?.6252:.5}))),console.log("Loaded examples from embedded HTML data:",appState.examples.length,"cases"),console.log(appState.examples)):appState.examples=[{id:"chen",name:"Chen",Gender:1,Age:65,NIHSS:10,Hypertension:1,hybridRisk:.2323},{id:"lv",name:"Lv",Gender:0,Age:72,NIHSS:15,Hypertension:0,hybridRisk:.8199},{id:"guo",name:"Guo",Gender:1,Age:58,NIHSS:8,Hypertension:1,hybridRisk:.6252}]}catch(e){console.error("Failed to load example data:",e),appState.examples=[]}displayExamples()}function displayExamples(){const e=document.getElementById("examples-list");if(!e)return;const t=appState.examples.map((e=>`\n                <div class="example-card" data-example-id="${e.id}">\n                    <h4>\n                        Patient: ${e.name} (ID: ${e.id})\n                        <span class="expand-icon">▼</span>\n                    </h4>\n                    <div class="patient-info">\n                        <span class="label">Gender:</span>\n                        <span class="value">${1===e.Gender?"Male":"Female"}</span>\n                        <span class="label">Age:</span>\n                        <span class="value">${e.Age} years</span>\n                        <span class="label">NIHSS:</span>\n                        <span class="value">${e.NIHSS}</span>\n                        <span class="label">Hypertension:</span>\n                        <span class="value">${1===e.Hypertension?"Yes":"No"}</span>\n                        <span class="label">Time from onset to MRI:</span>\n                        <span class="value">${e.Time_from_onset_to_MRI} hours</span>\n                        <span class="label">ADC &lt; 620 Volume:</span>\n                        <span class="value">${e.ADC_620} mL</span>\n                        <span class="label">Tmax > 6s Volume:</span>\n                        <span class="value">${e.Tmax_6s} mL</span>\n                        <span class="label">HIR:</span>\n                        <span class="value">${e.HIR?e.HIR.toFixed(3):"N/A"}</span>\n                    </div>\n                    <div class="risk-comparison">\n                        <h5>Risk Prediction Results:</h5>\n                        <div class="risk-values">\n                            <span>Subgroup-driven Model: ${(100*e.hybridRisk).toFixed(2)}%</span>\n                        </div>\n                        \x3c!-- <div class="risk-values"></div> --\x3e\n                    </div>\n                    <div class="example-images">\n                        <div class="images-grid">\n                            <div class="image-item">\n                                <h5>DWI and PWI Images</h5>\n                                ${e.pic0?`<img src="${e.pic0}" loading="lazy" alt="${e.name} DWI" >`:'<div class="image-placeholder">DWI and PWI Images<br>Not Available</div>'}\n                            </div>\n                            <div class="image-item">\n                                <h5>Tmax Image</h5>\n                                ${e.pic1?`<img src="${e.pic1}" loading="lazy" alt="${e.name} Tmax" onerror="this.parentElement.innerHTML='<div class=\\'image-placeholder\\'>Tmax Image<br>Not Available</div>'">`:'<div class="image-placeholder">Tmax Image<br>Not Available</div>'}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `)).join("");e.innerHTML=t,document.querySelectorAll(".example-card").forEach((e=>{e.addEventListener("click",(function(){this.classList.toggle("expanded")}))}))}async function updatePageViews(){try{const e=await fetch(CONFIG.API_URL+"hello",{method:"POST"});if(e.ok){const t=await e.json();void 0!==t.home&&(appState.pageViews.home=t.home),void 0!==t.hybrid&&(appState.modelUsage.hybrid=t.hybrid),console.log("Updated stats from server:",t)}}catch(e){console.warn("Unable to get server stats, using local count")}updateFloatingStats()}function updateFloatingStats(){const e=document.getElementById("home-views"),t=document.getElementById("hybrid-usage"),a=document.getElementById("floating-stats");e&&(e.textContent=appState.pageViews.home||0),t&&(t.textContent=appState.modelUsage.hybrid||0),a&&("floating"===appState.statsMode?a.classList.add("floating-mode"):a.classList.remove("floating-mode"))}function showLoading(e){const t=document.getElementById("loading");t&&(t.style.display=e?"flex":"none"),appState.isLoading=e}function setupStatsToggle(){const e=document.getElementById("stats-toggle");e&&e.addEventListener("click",(function(){"fixed"===appState.statsMode?(appState.statsMode="floating",e.textContent="📍",e.title="Switch to fixed mode"):(appState.statsMode="fixed",e.textContent="📌",e.title="Switch to floating mode"),updateFloatingStats()}))}document.addEventListener("DOMContentLoaded",(function(){initializeApp(),setupEventListeners(),loadExamples(),updatePageViews(),initializeScatterPlot(),setupStatsToggle()})),window.showSection=showSection</script><script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js')
      .then(() => console.log('SW registered'))
      .catch(err => console.error('SW failed', err));
  } else {
    console.log('do not have sw.js')
  }
</script></body></html>